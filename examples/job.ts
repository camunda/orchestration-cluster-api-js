// Compilable usage examples for job operations.
// These examples are type-checked during build to guard against API regressions.

import {
  createCamundaClient,
  JobKey,
  type Job,
  type JobActionReceipt,
} from '@camunda8/orchestration-cluster-api';

//#region ActivateJobs
async function activateJobsExample() {
  const camunda = createCamundaClient();

  const result = await camunda.activateJobs({
    type: 'payment-processing',
    timeout: 30000,
    maxJobsToActivate: 5,
  });

  for (const job of result.jobs) {
    console.log(`Job ${job.jobKey}: ${job.type}`);

    // Each enriched job has helper methods
    await job.complete({ paymentId: 'PAY-123' });
  }
}
//#endregion ActivateJobs

//#region CompleteJob
async function completeJobExample() {
  const camunda = createCamundaClient();

  const jobKey = JobKey.assumeExists('2251799813685249');

  await camunda.completeJob({
    jobKey,
    variables: {
      paymentId: 'PAY-123',
      status: 'completed',
    },
  });
}
//#endregion CompleteJob

//#region FailJob
async function failJobExample() {
  const camunda = createCamundaClient();

  const jobKey = JobKey.assumeExists('2251799813685249');

  await camunda.failJob({
    jobKey,
    retries: 2,
    errorMessage: 'Payment gateway timeout',
    retryBackOff: 5000,
  });
}
//#endregion FailJob

//#region CreateJobWorker
async function createJobWorkerExample() {
  const camunda = createCamundaClient();

  const worker = camunda.createJobWorker({
    jobType: 'payment-processing',
    jobTimeoutMs: 30000,
    maxParallelJobs: 5,
    jobHandler: async (job): Promise<JobActionReceipt> => {
      console.log(`Processing job ${job.jobKey}`);
      return job.complete({ processed: true });
    },
  });

  // Workers run continuously until closed
  // worker.close();
}
//#endregion CreateJobWorker

//#region JobWorker
async function jobWorkerExample() {
  const camunda = createCamundaClient();

  const worker = camunda.createJobWorker({
    jobType: 'payment-processing',
    jobTimeoutMs: 30000,
    maxParallelJobs: 5,
    jobHandler: async (job): Promise<JobActionReceipt> => {
      const orderId = job.variables.orderId;
      console.log(`Processing order: ${orderId}`);

      // Complete the job with result variables
      return job.complete({ paymentId: 'PAY-123' });
    },
  });

  // Workers run until closed
  // worker.close();
}
//#endregion JobWorker

//#region JobWorkerWithErrorHandling
async function jobWorkerWithErrorHandlingExample() {
  const camunda = createCamundaClient();

  const worker = camunda.createJobWorker({
    jobType: 'email-sending',
    jobTimeoutMs: 60000,
    maxParallelJobs: 10,
    pollIntervalMs: 300,
    jobHandler: async (job): Promise<JobActionReceipt> => {
      try {
        console.log(`Sending email for job ${job.jobKey}`);
        return job.complete({ sent: true });
      } catch (err) {
        return job.fail({
          errorMessage: String(err),
          retries: (job.retries ?? 1) - 1,
        });
      }
    },
  });

  void worker;
}
//#endregion JobWorkerWithErrorHandling

// Suppress "declared but never read"
void activateJobsExample;
void completeJobExample;
void failJobExample;
void createJobWorkerExample;
void jobWorkerExample;
void jobWorkerWithErrorHandlingExample;
